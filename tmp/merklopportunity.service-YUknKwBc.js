import{d as V}from"./module-3rE_GSaZ.js";import{f as _}from"./utils-BCzdQfNw.js";import{D as $}from"./pagination-lesfVksj.js";import{T as y}from"./useOpportunityFilters-DyAn3bHZ.js";import{a as F,C as K}from"./Wallet.context-BvbpRuml.js";import{i as G}from"./sha256-Cbe3se47.js";const J=()=>Object.values(K).filter(i=>typeof i=="number"),A=()=>[...F],C=()=>{const i=J(),r=new Set(F);return i.filter(h=>!r.has(h))},v=i=>i.join(","),se=V().create(({inject:i})=>{const r=(s,e,a=void 0)=>_("Opportunity",a)(s,e),h=i(["backend","request"]).inFunction(({backend:s,request:e},a)=>{if(!e)return a??{};const t=new URL(e.url),c=t.searchParams.get("search"),m=c?.startsWith("0x")&&c.length===66?c:void 0,p=t.searchParams.get("tokenType");let n;if(p===y.ALL)n=void 0;else if(p)n=p;else{const l=s.tokenType??"TOKEN";l===y.ALL?n=void 0:n=l}const o=t.searchParams.get("campaignTypes");let u;o==="active"?u=v(A()):o==="passive"?u=v(C()):o&&(u=o);const d={status:m?void 0:t.searchParams.get("status")??s.opportunityDefaultStatus?.join(",")??void 0,mainProtocolId:s.mainProtocols?.[0]??t.searchParams.get("protocol")??void 0,action:t.searchParams.get("action")??void 0,chainId:s.chains?.length===1?s.chains[0].id:t.searchParams.get("chain")??void 0,minimumTvl:t.searchParams.get("minimumTvl")??void 0,maximumTvl:t.searchParams.get("maximumTvl")??void 0,minimumApr:t.searchParams.get("minimumApr")??void 0,maximumApr:t.searchParams.get("maximumApr")??void 0,minimumDailyRewards:t.searchParams.get("minimumDailyRewards")??void 0,maximumDailyRewards:t.searchParams.get("maximumDailyRewards")??void 0,distributionTypes:t.searchParams.get("distributionTypes")??void 0,items:t.searchParams.get("items")?Number(t.searchParams.get("items")):$,sort:t.searchParams.get("sort")?.split("-")[0],order:t.searchParams.get("sort")?.split("-")[1],search:c,test:t.searchParams.get("test")!==null?t.searchParams.get("test")==="true":s.alwaysShowTestTokens??void 0,tokenTypes:n?[n]:void 0,page:t.searchParams.get("page")?Math.max(Number(t.searchParams.get("page"))-1,0):void 0,tags:s.tags?.[0]?s.tags?.[0]:t.searchParams.get("tag")??void 0,excludeSubCampaigns:s.excludeSubCampaigns?!0:t.searchParams.get("excludeSubCampaigns")!==null?t.searchParams.get("excludeSubCampaigns")==="true":void 0,stablecoin:t.searchParams.get("stablecoin")!==null?t.searchParams.get("stablecoin")==="true":void 0,tokens:t.searchParams.get("tokens")??void 0,campaignTypes:u,...a};return Object.fromEntries(Object.entries(d).filter(([,l])=>l!=null))}),x=i(["api","request","backend"]).inFunction(({api:s,request:e,backend:a},t)=>T.handler({api:s,backend:a},Object.assign(h.handler({backend:a,request:e}),t??{}))),T=i(["api","backend"]).inFunction(async({api:s,backend:e},a)=>{const t={...a,sort:a.sort??e.sortedBy},c=await r(s.v4.opportunities.get,{headers:e.showDevelopmentHelpers?{"cache-control":"no-cache"}:{},query:Object.assign({...t},{tags:e.tags?.[0]?e.tags?.[0]:a.tags,chainId:e.chains?.length===1?e.chains[0].id:a.chainId})}),m=await r(s.v4.opportunities.count.get,{headers:e.showDevelopmentHelpers?{"cache-control":"no-cache"}:{},query:Object.assign({...t},{tags:e.tags?.[0]?e.tags?.[0]:a.tags,chainId:e.chains?.length===1?e.chains[0].id:a.chainId})});return{opportunities:c.filter(p=>p!==null),count:m}}),I=i(["api","request","backend"]).inFunction(async({api:s,request:e,backend:a},t)=>a.featured?.enabled?await T.handler({api:s,backend:a},Object.assign(h.handler({backend:a,request:e}),{items:a.featured.length,...t})):{opportunities:[],count:0}),O=i(["api"]).inFunction(async({api:s},e)=>{await r(a=>s.v4.opportunities({id:e}).post({},a),{headers:{authorization:""}})}),R=i(["api"]).inFunction(async({api:s},e)=>{await r(a=>s.v4.campaigns.tvls({opportunityId:e}).put({},a),{headers:{authorization:""}})}),D=i(["api"]).inFunction(async({api:s},e,a)=>{await r(t=>s.v4.opportunities({id:e}).override.patch(a,t),{})}),L=i(["api"]).inFunction(async({api:s},e,a)=>{await r(t=>s.v4.opportunities({id:e}).override.delete(a,t),{})}),q=i(["api"]).inFunction(async({api:s},e,a)=>{await r(t=>s.v4.opportunities({id:e}).patch(a,t),{})}),E=i(["api","request"]).inFunction(async({api:s,request:e},a)=>r(t=>s.v4.opportunities({id:a}).get({query:{},...t}),{headers:{}},e)),b=i(["api","backend","request"]).inFunction(async({api:s,backend:e,request:a},t)=>{if(!a)throw new Error("Request is required for getCampaignsByParams");const c=new URL(a.url),{chainId:m,type:p,identifier:n}=t,o=await r(s.v4.opportunities({id:`${m}-${p}-${n}`}).campaigns.get,{headers:e.showDevelopmentHelpers?{"cache-control":"no-cache"}:{},query:{test:c.searchParams.get("test")==="true"?!0:e.alwaysShowTestTokens??void 0,point:c.searchParams.get("point")==="true"?!0:c.searchParams.get("point")==="false"?!1:e.alwaysShowPointTokens??void 0,excludeSubCampaigns:e.excludeSubCampaigns?!0:c.searchParams.get("excludeSubCampaigns")!==null?c.searchParams.get("excludeSubCampaigns")==="true":void 0}},a);if(e.tags?.length){const u=[...o.tags??[],o.protocol?.id??""];if(!e.tags.every(f=>u.includes(f)))throw new Response("Opportunity inaccessible",{status:403})}if(e.mainProtocols?.length){const u=o.mainProtocol;if(!u||!e.mainProtocols.includes(u))throw new Response("Opportunity inaccessible",{status:403})}return o}),B=i(["api","backend"]).inFunction(async({api:s,backend:e},a)=>{const{identifier:t,test:c,excludeSubCampaigns:m}=a;return await r(s.v4.opportunities.campaigns.get,{headers:e.showDevelopmentHelpers?{"cache-control":"no-cache"}:{},query:{test:c??e.alwaysShowTestTokens??void 0,point:e.alwaysShowPointTokens??void 0,excludeSubCampaigns:e.excludeSubCampaigns?!0:m??void 0,mainParameter:t}})}),H=i(["api","backend"]).inFunction(({api:s,backend:e},a,t)=>r(s.v4.opportunities.aggregate({field:t}).get,{headers:e.showDevelopmentHelpers?{"cache-control":"no-cache"}:{},query:a})),M=i(["api"]).inFunction(({api:s},e)=>r(s.v3.poolInfo.get,{query:Object.assign({...e})})),W=i(["api"]).inFunction(({api:s},e)=>r(s.v4.opportunities.bins.tvl.get,{query:e})),z=i(["api"]).inFunction(({api:s},e)=>r(s.v4.opportunities.bins.apr.get,{query:e})),N=i(["api"]).inFunction(({api:s},e)=>r(s.v4.opportunities.bins["daily-rewards"].get,{query:e})),U=i(["api","backend"]).inFunction(async({api:s,backend:e},a)=>{const c=new URL(window.location.href).searchParams.get("tokenType"),m=window.location.pathname;let p;if(c===y.ALL)p=void 0;else if(c)p=c;else{const g=e.tokenType??"TOKEN";p=g===y.ALL?void 0:g}const n={...a},o=m.split("/").filter(Boolean);o[0]==="protocols"&&o[1]&&(n.mainProtocolId=[o[1]]),o[0]==="chains"&&o[1]&&(n.chainName=[o[1]]),o[0]==="programs"&&o[1]&&(n.programSlugs=[o[1]]),o[0]==="users"&&o[1]&&(G(o[1])?n.creatorAddress=o[1]:n.creatorSlug=o[1]);let u;n.campaignTypes==="active"?u=v(A()):n.campaignTypes==="passive"?u=v(C()):n.campaignTypes&&(u=n.campaignTypes);const d={test:n.test??void 0,...n,campaignTypes:u,tokenTypes:p?[p]:void 0,excludeSubCampaigns:e.excludeSubCampaigns?!0:n.excludeSubCampaigns??void 0,stablecoin:n.stablecoin??void 0,tokens:n.tokens??void 0},l=(g=>{const w={};for(const S in g){const P=g[S];w[S]=Array.isArray(P)?P.join(","):P}return w})(d);return{count:await r(s.v4.opportunities.count.get,{headers:e.showDevelopmentHelpers?{"cache-control":"no-cache"}:{},query:{...l,...e.tags?.[0]?{tags:e.tags[0]}:{},...e.chains?.length===1?{chainId:e.chains[0].id.toString()}:{},...e.mainProtocols?.[0]?{mainProtocolId:e.mainProtocols[0]}:{}}})}}),Q=i(["api"]).inFunction(({api:s},e,a)=>r(s.v4.clamm.pools({chainId:a})({poolId:e}).get,{}));return{reparse:O,refreshMetadata:R,getCount:U,getTVL:W,getAPR:z,getDailyRewards:N,getMany:T,getAggregate:H,searchUniswapV4Pool:Q,getManyFromRequest:x,getFeatured:I,getCampaignsByParams:b,getCampaignsByIdentifier:B,override:D,deleteOverride:L,update:q,getPoolInfo:M,getById:E}});export{se as O};
